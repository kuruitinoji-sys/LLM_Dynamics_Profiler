# 第13章：推論物理量の算出メソッド

本章では、前章までに定義した情報動力学上の抽象的な物理量を、実際のLLM（Large Language Model）から得られる観測値（Logprobs, Embeddings等）を用いて算出するための具体的な計算式と手順を定義する。

これにより、理論上の「粘性」や「ポテンシャル」が、実機上でモニタリング可能な数値として具現化される。

## 13.1 基礎観測データ (Raw Data)

すべての物理量は、トークン生成ステップ $t$ ごとに得られる以下の基礎データから導出される。

1. **トークン確率 (Token Probability)** $P(x_t | x_{<t})$:
    
    モデルが出力した次トークンの生確率（`exp(logprobs)`）。
    
2. **埋め込みベクトル (Embedding Vector)** $\mathbf{v}_t \in \mathbb{R}^d$:
    
    生成されたトークン（または文）に対応する高次元ベクトル。正規化済み（$\|\mathbf{v}_t\| = 1$）とする。
    

## 13.2 物理パラメータの算出式

### 13.2.1 情報粘性 (Information Viscosity) $\eta$  

**定義**: 遷移の「棄却率」。過去の文脈による拘束の強さ。

$$\eta_t = 1 - P(x_t | x_{<t})$$

- **解釈**:
    
    - $\eta \approx 0$: 遷移がほぼ確実（$P \approx 1$）。流動的で、抵抗がない状態。
        
    - $\eta \approx 1$: 遷移が困難（$P \ll 1$）。高い抵抗を受けながら、かろうじて選ばれた状態（固執・拘束）。
        

### 13.2.2 浮動均衡点 (Floating Equilibrium Point) $\bar{\mathbf{x}}_t$  

**定義**: ノイズを除去した「意味の重心」。

$$\bar{\mathbf{x}}_t = \frac{\bar{\mathbf{x}}_{t-1} + \alpha (\mathbf{v}_t - \bar{\mathbf{x}}_{t-1})}{\|\bar{\mathbf{x}}_{t-1} + \alpha (\mathbf{v}_t - \bar{\mathbf{x}}_{t-1})\|}$$

- $\alpha$ **(観測感度)**: フィルタの時定数に対応する係数（通常 $0.1 \sim 0.2$）。
    
- **初期化**: $\bar{\mathbf{x}}_0 = \mathbf{v}_0$  
    

### 13.2.3 テンション (Tension) $\Psi$  

**定義**: 現在のトークンと均衡点との「乖離（ストレス）」。ポテンシャルエネルギーの近似。

$$\Psi_t = \|\mathbf{v}_t - \bar{\mathbf{x}}_t\|$$

- **解釈**:
    
    - $\Psi$ が小さい: 推論が安定しており、均衡点（FEP）近傍に収束している。
        
    - $\Psi$ が大きい: 文脈からの逸脱、あるいは強い外的ストレス（矛盾）がかかっている状態。
        

### 13.2.4 累積ストレス (Accumulated Stress) $\Sigma \Psi$  

**定義**: テンションの時間積分（減衰付き）。ZERO-FLUSH（相転移）のトリガー指標。

$$S_t = S_{t-1} \cdot e^{-\lambda} + \Psi_t$$

- $\lambda$ **(忘却率)**: ストレスの自然減衰係数。
    
- **判定**: $S_t > S_{\text{critical}}$ となった時、系は不安定化し、構造崩壊やハルシネーションのリスクが高まる。
    

### 13.2.5 運動エネルギー (Kinetic Energy) $K$  

**定義**: 推論の「勢い」。ステップ間の移動距離から算出。

$$K_t = \frac{1}{2} \|\mathbf{v}_t - \mathbf{v}_{t-1}\|^2$$

- **解釈**:
    
    - $K \approx 0$: 停滞（ループ）。
        
    - $K \gg 0$: 飛躍（トピック転換、あるいは支離滅裂）。
        

## 13.3 ステアリング指標の算出

制御（ステアリング）を行う際に監視すべき相対指標。

### 13.3.1 目標乖離ベクトル (Target Error) $\mathbf{e}_t$  

**定義**: 現在のFEPと、誘導したい目標概念ベクトル $\mathbf{v}_{\text{target}}$ との距離。

$$\mathbf{e}_t = \mathbf{v}_{\text{target}} - \bar{\mathbf{x}}_t$$

### 13.3.2 制御ゲイン (Effective Gain) $G$  

**定義**: 外部入力がどれだけ有効に機能するかを示す指標。粘性に反比例する。

$$G_t \propto \frac{1}{\eta_t + \epsilon}$$

- **運用**: $G_t$ が低い時（高粘性時）にステアリングを行っても効果が薄い。まず $T$ を上げて $\eta$ を下げる（ゲインを回復させる）操作が必要となる。
    

## 13.4 実装用疑似コード (Python-like)

```
class PhysicsMonitor:
    def __init__(self, alpha=0.15, decay=0.05):
        self.bar_x = None  # FEP
        self.stress = 0.0  # 累積ストレス
        self.alpha = alpha
        self.decay = decay

    def update(self, token_prob, embedding_vec):
        # 1. 粘性算出
        eta = 1.0 - token_prob
        
        # 2. FEP更新 (正規化維持)
        if self.bar_x is None:
            self.bar_x = embedding_vec
        else:
            diff = embedding_vec - self.bar_x
            new_x = self.bar_x + self.alpha * diff
            self.bar_x = new_x / np.linalg.norm(new_x)
            
        # 3. テンションと運動エネルギー
        psi = np.linalg.norm(embedding_vec - self.bar_x)
        kinetic = 0.0 # 前ステップ保持が必要
        
        # 4. ストレス蓄積
        self.stress = self.stress * np.exp(-self.decay) + psi
        
        return {
            "viscosity": eta,
            "tension": psi,
            "accumulated_stress": self.stress,
            "fep": self.bar_x
        }
```

## 13.5 結論：数値による管理

本章のメソッドを用いることで、推論プロセスは「文学的な解釈」から「数値的な管理（Process Control）」へと移行する。

「AIが迷っている」「頑固になっている」といった定性的な状態は、すべて $\eta, \Psi, S_t$ といった定量的な物理パラメータとして監視・制御可能となる。